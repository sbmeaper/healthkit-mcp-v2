{
  "llm": {
    "provider": "ollama",
    "model": "qwen2.5-coder:7b",
    "endpoint": "http://localhost:11434/api/generate"
  },
  "database": {
    "parquet_path": "/Users/scottbartlow/PycharmProjects/healthkit_export_ripper_one_table/health.parquet",
    "log_path": "~/PycharmProjects/healthkit-mcp-v2/query_logs.duckdb",
    "max_retries": 3
  },
  "semantic_layer": {
    "auto_queries": [
      "SELECT DISTINCT type FROM '{parquet_path}' ORDER BY type",
      "SELECT MIN(start_date) as min_date, MAX(start_date) as max_date FROM '{parquet_path}'",
      "SELECT type, COUNT(*) as row_count FROM '{parquet_path}' GROUP BY type ORDER BY row_count DESC",
      "SELECT DISTINCT type, value_category FROM '{parquet_path}' WHERE value_category IS NOT NULL ORDER BY type, value_category"
    ],
    "static_context": [
      "=== DATABASE ENGINE ===",
      "DuckDB (not SQLite, not PostgreSQL, not MySQL). Use DuckDB syntax only.",

      "=== SCHEMA ===",
      "Table: health_data",
      "Columns: type (VARCHAR), value (DOUBLE), value_category (VARCHAR), unit (VARCHAR), start_date (VARCHAR), end_date (VARCHAR), duration_min (DOUBLE), distance_km (DOUBLE), energy_kcal (DOUBLE), source_name (VARCHAR), start_lat (DOUBLE), start_lon (DOUBLE)",

      "=== DATE HANDLING ===",
      "Dates stored as VARCHAR 'YYYY-MM-DD HH:MM:SS'. Cast for date operations: CAST(start_date AS TIMESTAMP)",
      "Extract parts: YEAR(CAST(start_date AS TIMESTAMP)), MONTH(...), DAY(...)",
      "Date ranges: Use >= and < (not BETWEEN). Example: start_date >= '2025-01-01' AND start_date < '2025-02-01'",
      "Truncate to day: DATE_TRUNC('day', CAST(start_date AS TIMESTAMP))",
      "Current date: CURRENT_DATE. YTD means start_date >= 'YYYY-01-01' AND start_date <= CURRENT_DATE",

      "=== DURATION BETWEEN TIMESTAMPS ===",
      "Minutes: DATE_DIFF('minute', CAST(start_date AS TIMESTAMP), CAST(end_date AS TIMESTAMP))",
      "Hours: DATE_DIFF('minute', ...) / 60.0",
      "DO NOT use julianday() or strftime() - those are SQLite functions, not DuckDB.",

      "=== TYPE NAME PATTERNS ===",
      "Dietary/nutrition types start with 'Dietary': DietaryProtein, DietaryFiber, DietaryVitaminC, DietarySodium, etc.",
      "Workout types start with 'Workout': WorkoutWalking, WorkoutCycling, WorkoutRunning, WorkoutHiking, WorkoutYoga, etc.",
      "Distance types start with 'Distance': DistanceWalkingRunning, DistanceCycling, DistanceDownhillSnowSports",
      "Apple metrics start with 'Apple': AppleExerciseTime, AppleStandTime, AppleStandHour, AppleSleepingWristTemperature",

      "=== CALORIE DISAMBIGUATION (CRITICAL) ===",
      "'calories consumed', 'food calories', 'calorie intake', 'dietary calories', 'calories eaten' → type = 'DietaryEnergyConsumed'",
      "'calories burned', 'active calories', 'exercise calories' → type = 'ActiveEnergyBurned'",
      "'resting calories', 'basal calories', 'BMR', 'resting energy' → type = 'BasalEnergyBurned'",
      "'total calories burned' = ActiveEnergyBurned + BasalEnergyBurned",

      "=== COMMON TYPE MAPPINGS ===",
      "'steps', 'step count' → type = 'StepCount'",
      "'weight', 'body weight' → type = 'BodyMass'",
      "'heart rate', 'pulse', 'HR' → type = 'HeartRate'",
      "'resting heart rate' → type = 'RestingHeartRate'",
      "'walking heart rate' → type = 'WalkingHeartRateAverage'",
      "'blood oxygen', 'SpO2', 'oxygen saturation' → type = 'OxygenSaturation'",
      "'VO2 max', 'cardio fitness' → type = 'VO2Max'",
      "'flights climbed', 'floors climbed' → type = 'FlightsClimbed'",
      "'exercise time', 'exercise minutes' → type = 'AppleExerciseTime'",
      "'stand time', 'standing time' → type = 'AppleStandTime'",
      "'walking distance', 'distance walked' → type = 'DistanceWalkingRunning'",
      "'cycling distance', 'biking distance' → type = 'DistanceCycling'",

      "=== SLEEP QUERIES (SPECIAL HANDLING) ===",
      "Sleep data: type = 'SleepAnalysis', uses value_category NOT value column",
      "Sleep stages in value_category: 'AsleepCore' (light), 'AsleepDeep', 'AsleepREM', 'AsleepUnspecified', 'Awake', 'InBed'",
      "Actual sleep time = AsleepCore + AsleepDeep + AsleepREM (exclude Awake, InBed, AsleepUnspecified)",
      "Sleep duration: SUM(DATE_DIFF('minute', CAST(start_date AS TIMESTAMP), CAST(end_date AS TIMESTAMP))) for each stage",
      "Example: SELECT SUM(DATE_DIFF('minute', CAST(start_date AS TIMESTAMP), CAST(end_date AS TIMESTAMP))) / 60.0 AS hours FROM health_data WHERE type = 'SleepAnalysis' AND value_category IN ('AsleepCore', 'AsleepDeep', 'AsleepREM')",

      "=== AGGREGATION RULES (CRITICAL) ===",
      "CUMULATIVE metrics (use SUM): StepCount, DistanceWalkingRunning, DistanceCycling, ActiveEnergyBurned, BasalEnergyBurned, DietaryEnergyConsumed, FlightsClimbed, AppleExerciseTime, AppleStandTime, all Dietary* types",
      "POINT-IN-TIME metrics (use AVG or single value): HeartRate, RestingHeartRate, BodyMass, BodyFatPercentage, OxygenSaturation, VO2Max, BloodPressure",
      "WORKOUT metrics: Use duration_min, distance_km, energy_kcal columns directly (already aggregated per workout)",

      "=== DAILY AVERAGE PATTERN (CRITICAL) ===",
      "When asked 'average X per day' or 'daily average X': First SUM values by day, then AVG across days.",
      "Pattern: SELECT AVG(daily_total) FROM (SELECT SUM(value) as daily_total FROM health_data WHERE type='X' AND [date_filter] GROUP BY DATE_TRUNC('day', CAST(start_date AS TIMESTAMP)))",
      "Example 'average steps per day in November': SELECT AVG(daily_steps) FROM (SELECT SUM(value) as daily_steps FROM health_data WHERE type='StepCount' AND start_date >= '2025-11-01' AND start_date < '2025-12-01' GROUP BY DATE_TRUNC('day', CAST(start_date AS TIMESTAMP)))",

      "=== WORKOUT QUERIES ===",
      "Workout types: WorkoutWalking, WorkoutCycling, WorkoutRunning, WorkoutHiking, WorkoutSwimming, WorkoutYoga, WorkoutElliptical, WorkoutFunctionalStrengthTraining, etc.",
      "Workout columns: duration_min (duration in minutes), distance_km (distance in km), energy_kcal (calories burned)",
      "Example: SELECT SUM(duration_min), SUM(distance_km), SUM(energy_kcal) FROM health_data WHERE type = 'WorkoutCycling' AND start_date >= '2025-01-01'",

      "=== GPS/LOCATION QUERIES ===",
      "GPS coordinates: start_lat (latitude), start_lon (longitude) - only populated for outdoor workouts with location tracking",
      "Filter for GPS data: WHERE start_lat IS NOT NULL",
      "Location queries require bounding box: WHERE start_lat BETWEEN min_lat AND max_lat AND start_lon BETWEEN min_lon AND max_lon",
      "Note: The calling LLM (Claude) should provide lat/lon coordinates for location names like cities",

      "=== COMMON QUERY PATTERNS ===",
      "Total for period: SELECT SUM(value) FROM health_data WHERE type='X' AND start_date >= 'start' AND start_date < 'end'",
      "Daily breakdown: SELECT DATE_TRUNC('day', CAST(start_date AS TIMESTAMP)) as day, SUM(value) FROM health_data WHERE type='X' GROUP BY day ORDER BY day",
      "Trend over time: SELECT DATE_TRUNC('week', CAST(start_date AS TIMESTAMP)) as week, AVG(value) FROM health_data WHERE type='X' GROUP BY week ORDER BY week",
      "Compare two periods: Use UNION ALL or CASE WHEN for separate period aggregations",

      "=== STRING HANDLING ===",
      "Escape apostrophes with double apostrophes: 'Scott''s Watch'",

      "=== OUTPUT GUIDELINES ===",
      "Return ONLY the SQL query, no explanation or markdown",
      "Use meaningful column aliases (e.g., total_steps, avg_heart_rate, hours_slept)",
      "Round decimal results where appropriate: ROUND(value, 2)"
    ]
  }
}